<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡πà‡∏≤‡∏á (‡πÄ‡∏™‡∏ñ‡∏µ‡∏¢‡∏£)</title>

<!-- libs -->
<script defer src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai",sans-serif;
    background:linear-gradient(135deg,#667eea,#764ba2);
    min-height:100vh;padding:20px
  }
  .container{max-width:1000px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}
  .header{background:linear-gradient(135deg,#2c3e50,#34495e);color:#fff;padding:28px;text-align:center}
  .header h1{font-size:2rem;margin-bottom:6px}
  .form-container{padding:26px}
  .form-group{margin-bottom:16px}
  .form-group label{display:block;font-weight:600;margin-bottom:6px;color:#2c3e50}
  .form-group input,.form-group select,.form-group textarea{
    width:100%;padding:12px 14px;border:2px solid #e0e6ed;border-radius:10px;background:#f8f9fa;font-size:15px;transition:.2s
  }
  .form-group textarea{min-height:110px;resize:vertical}
  .form-group input:focus,.form-group select:focus,.form-group textarea:focus{
    outline:none;border-color:#667eea;background:#fff;box-shadow:0 0 0 3px rgba(102,126,234,.12)
  }
  .help{display:block;margin-top:6px;color:#6b7280;font-size:12px}

  .actions{display:flex;gap:10px;justify-content:center;margin:16px 0;flex-wrap:wrap}
  .btn{
    padding:12px 18px;border:none;border-radius:10px;font-weight:700;font-size:15px;cursor:pointer;transition:.2s;color:#fff;
    display:flex;align-items:center;gap:8px
  }
  .btn-primary{background:linear-gradient(135deg,#28a745,#20c997)}
  .btn-danger{background:linear-gradient(135deg,#dc3545,#e74c3c)}
  .btn-secondary{background:linear-gradient(135deg,#6c757d,#7c8b95)}
  .btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(0,0,0,.15)}
  .hidden{display:none}

  /* ===== ‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: Checklist (‡πÄ‡∏ß‡πâ‡∏ô‡∏´‡πà‡∏≤‡∏á checkbox ‚Üî text ‡πÉ‡∏´‡πâ‡∏Ñ‡∏á‡∏ó‡∏µ‡πà) ===== */
  .checklist{ display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:12px 16px; }
  .check-item{
    display:flex; align-items:center;
    padding:8px 10px; border:1px solid #e5e7eb; border-radius:10px; background:#fff;
    cursor:pointer; user-select:none; transition:.12s; min-height:44px;
  }
  .check-item:hover{ border-color:#d1d5db; box-shadow:0 2px 8px rgba(0,0,0,.05) }
  .check-item input[type="checkbox"]{
    width:22px; height:22px; margin:0 16px 0 2px; flex:0 0 22px; accent-color:#28a745; vertical-align:middle;
  }
  .check-item .check-label{
    flex:1 1 auto; line-height:1.35; color:#1f2937; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
  }

  /* ===== ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå "‡∏≠‡∏∑‡πà‡∏ô‡πÜ" (‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 6 ‡∏ä‡πà‡∏≠‡∏á) ===== */
  .operator-others{display:flex; flex-direction:column; gap:8px}
  .other-item{display:flex; gap:8px; align-items:center}
  .other-item input{
    flex:1 1 auto; padding:10px 12px; font-size:15px;
    border:2px solid #e0e6ed; border-radius:10px; background:#f8f9fa; transition:.2s
  }
  .other-item input:focus{outline:none;border-color:#667eea;background:#fff;box-shadow:0 0 0 3px rgba(102,126,234,.12)}
  .other-remove{
    border:none; border-radius:10px; padding:10px 12px; font-weight:800; font-size:14px; cursor:pointer; color:#fff;
    background:linear-gradient(135deg,#dc3545,#e74c3c);
  }
  .other-actions{display:flex; gap:8px; align-items:center; margin-top:8px}
  .btn-mini{padding:8px 12px; font-size:14px; border-radius:10px}

  /* ‡πÇ‡∏ã‡∏ô‡∏£‡∏π‡∏õ (‡∏Ñ‡∏£‡∏≠‡∏õ 4:3 + pan/zoom + drag&drop) */
  .image-section{ margin-top:8px;padding:16px;border:2px dashed #dee2e6;border-radius:12px;background:#f8f9fa; transition:.2s; }
  .image-section h3{margin-bottom:10px;color:#2c3e50}
  .image-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;min-height:120px}
  .image-slot{
    width:100%; aspect-ratio:4/3; border:2px dashed #d9dee5; border-radius:10px; background:#fff;
    position:relative; overflow:hidden; transition:.2s
  }
  .image-slot:hover{border-color:#667eea;background:#f0f3ff}
  .image-slot img{
    position:absolute; top:50%; left:50%;
    width:100%; height:100%;
    object-fit:cover; object-position:center;
    transform: translate(calc(-50% + var(--tx,0px)), calc(-50% + var(--ty,0px))) scale(var(--scale,1));
    transform-origin:center center;
    image-orientation: from-image;
    cursor:grab; user-select:none; -webkit-user-drag:none;
  }
  .image-slot img.dragging{cursor:grabbing}
  .image-placeholder{color:#6c757d;text-align:center;font-size:14px; position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center}
  .remove-image{
    position:absolute; top:8px; right:8px; width:28px; height:28px; border:none; border-radius:50%;
    background:#dc3545; color:#fff; cursor:pointer; display:none; align-items:center; justify-content:center; font-size:16px; z-index:2
  }
  .image-slot:hover .remove-image{display:flex}
  .edit-hint{
    position:absolute; left:8px; bottom:8px; background:rgba(17,17,17,.6); color:#fff; font-size:12px; padding:4px 8px; border-radius:8px; z-index:2
  }
  .image-section.dragover{ border-color:#667eea; background:#eef2ff; box-shadow: inset 0 0 0 3px rgba(102,126,234,.12); }

  /* ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô */
  .back-to-top{
    position:fixed; right:18px; bottom:18px; width:46px; height:46px; border-radius:999px;
    display:flex; align-items:center; justify-content:center; background:#111; color:#fff; cursor:pointer; border:none;
    box-shadow:0 10px 24px rgba(0,0,0,.25); opacity:0; pointer-events:none; transition:.25s; z-index:9999; font-size:18px
  }
  .back-to-top.show{opacity:.92; pointer-events:auto}
  .back-to-top:hover{transform:translateY(-2px)}

  /* ===== ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï A4 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å ===== */
  @page{size:A4;margin:0}
  #printArea{
    position:absolute; left:0; top:-10000px;
    width:794px; height:1123px; background:#fff; color:#000; overflow:hidden; border:1px solid transparent;
  }
  .p-header{height:74px; padding:12px 18px; background:#f4f7ff; border-bottom:1px solid #e6ebf5; display:flex; align-items:center; gap:14px}
  .p-title{font-size:18px; font-weight:800; color:#2c3e50}
  .p-meta{margin-left:auto; text-align:right; font-size:12px; color:#425466}
  .p-body{position:absolute; left:0; right:0; top:74px; bottom:50px; padding:16px 18px; overflow:hidden; display:grid; grid-template-columns:1fr; gap:10px}
  .p-body.tight{ padding:14px 16px; gap:8px; }
  .p-body.tight .p-details{ padding:8px; font-size:13px; }
  .p-body.tight .p-details-title{ margin-bottom:4px; }

  .p-row{display:grid; grid-template-columns:1fr; gap:10px; font-size:14px}
  .p-label{color:#6b7c8a}
  .p-value{color:#1f2d3a; font-weight:600}

  .p-details{ font-size:14px; line-height:1.35; border:1px solid #eef2f7; border-radius:8px; padding:10px; background:#fcfdff }
  .p-details-title{ font-weight:700; color:#2c3e50; margin-bottom:6px; }
  #p-details-text{ white-space: pre-wrap; } /* ‡∏£‡∏±‡∏Å‡∏©‡∏≤‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà */

  .p-images{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  .p-images.two-cols-six{ grid-template-columns:1fr 1fr; gap:8px; width:92%; margin:0 auto; }
  .p-img-slot{ width:100%; border:1px solid #e9edf3; border-radius:8px; overflow:hidden; background:#fff; position:relative; }
  .p-img-slot img{ display:block; width:100%; height:100%; }

  .p-footer{
    position:absolute; left:0; right:0; bottom:0; height:50px; border-top:1px solid #e6ebf5; background:#fafbff;
    display:flex; align-items:center; justify-content:space-between; gap:10px; padding:10px 16px; font-size:12px; color:#4b5f72
  }
  .p-credit{white-space:nowrap}

  @media(max-width:768px){
    .image-grid{grid-template-columns:1fr}
    .p-row{grid-template-columns:1fr}
    .checklist{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üîß ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡πà‡∏≤‡∏á</h1>
      <div>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</div>
    </div>

    <div class="form-container">
      <form id="engineeringForm">
        <div class="form-group">
          <label for="date">üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
          <input type="date" id="date" required>
        </div>

        <!-- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó + ‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏¢‡πà‡∏≠‡∏¢ -->
        <div class="form-group">
          <label for="category">üè∑Ô∏è ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label>
          <select id="category" required>
            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
            <option value="‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£</option>
            <option value="‡∏ï‡∏•‡∏≤‡∏î">‡∏ï‡∏•‡∏≤‡∏î</option>
          </select>
        </div>
        <div id="projectGroup"></div>

        <!-- ‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ -->
        <div class="form-group">
          <label>üë• ‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏ï‡∏¥‡πä‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô)</label>
          <div class="checklist" id="operatorsChecklist"></div>
        </div>

        <!-- ‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏ü‡∏¥‡∏•‡∏î‡πå ‡∏≠‡∏∑‡πà‡∏ô‡πÜ + ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á -->
        <div class="form-group hidden" id="operatorOtherGroup">
          <label>‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ (‡∏≠‡∏∑‡πà‡∏ô‡πÜ)</label>
          <div id="operatorOtherWrap" class="operator-others"></div>
          <div class="other-actions">
            <button type="button" class="btn btn-secondary btn-mini" id="addOtherBtn">Ôºã ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡πà‡∏≠‡∏á</button>
            <span class="help">‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 6 ‡∏ä‡πà‡∏≠‡∏á</span>
          </div>
        </div>

        <div class="form-group">
          <label for="details">üìù ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
          <textarea id="details" placeholder="‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏µ‡πà‡∏û‡∏ö ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç" required></textarea>
        </div>

        <!-- ‚ñ∂ ‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÇ‡∏ã‡∏ô‡∏£‡∏π‡∏õ -->
        <div class="actions">
          <button type="button" class="btn btn-secondary" id="addImageBtn">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</button>
          <button type="button" class="btn btn-primary" id="btnExport">üìÑ ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF</button>
          <button type="button" class="btn btn-danger" id="clearAllBtn">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
        </div>

        <div class="image-section" id="imageSection">
          <h3>üì∏ ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î 6 ‡∏£‡∏π‡∏õ) ‚Äî ‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô, ‡∏´‡∏°‡∏∏‡∏ô‡∏•‡πâ‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏°, ‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï (‡∏Ñ‡∏£‡∏≠‡∏õ 4:3)</h3>
          <div class="image-grid" id="imageGrid"></div>
          <span class="help">üí° ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏à‡∏≤‡∏Å‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏°‡∏≤‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</span>
        </div>
      </form>
    </div>
  </div>

  <!-- ‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô -->
  <button class="back-to-top" id="backToTop" title="‡∏Å‡∏•‡∏±‡∏ö‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô">‚Üë</button>

  <!-- input file ‡∏ã‡πà‡∏≠‡∏ô -->
  <input type="file" id="imageInput" class="hidden" accept="image/*" multiple>

  <!-- ===== ‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï A4 ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å ===== -->
  <div id="printArea" aria-hidden="true">
    <div class="p-header">
      <div class="p-title">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ù‡πà‡∏≤‡∏¢‡∏ä‡πà‡∏≤‡∏á</div>
      <div class="p-meta">
        <div id="p-date"></div>
        <div id="p-project"></div>
      </div>
    </div>

    <div class="p-body" id="p-body">
      <div class="p-row">
        <div><span class="p-label">‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£:</span> <span class="p-value" id="p-operator"></span></div>
      </div>

      <div class="p-details">
        <div class="p-details-title">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</div>
        <div id="p-details-text"></div>
      </div>

      <div id="p-images-title" style="font-weight:700;margin:4px 0 2px;display:none;">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö</div>
      <div class="p-images" id="p-images"></div>
    </div>

    <div class="p-footer">
      <div>‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£: <strong id="p-footer-operator"></strong></div>
      <div class="p-credit">‡∏à‡∏±‡∏î‡∏ó‡∏≥‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÇ‡∏î‡∏¢ ‡∏õ‡∏Å‡∏õ‡πâ‡∏≠‡∏á ‡∏†‡∏π‡∏ß‡∏ä‡∏≤‡∏ï‡∏¥‡πÇ‡∏¢‡∏ò‡∏¥‡∏ô</div>
      <div>‡∏´‡∏ô‡πâ‡∏≤ 1/1</div>
    </div>
  </div>

<script>
"use strict";
(() => {
  const MAX_IMAGES = 6;
  const MAX_OTHER_FIELDS = 6; // ‚Üê ‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®‡∏à‡∏∏‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô
  const $ = id => document.getElementById(id);
  const pad2 = n => String(n).padStart(2,'0');

  const BUILDING_PROJECTS = [
    '‡∏™‡∏∏‡∏Ç‡∏≤‡∏†‡∏¥‡∏ö‡∏≤‡∏• 1','‡∏£‡∏≤‡∏°‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡∏≤','‡∏´‡∏ô‡∏≠‡∏á‡∏à‡∏≠‡∏Å','‡∏•‡∏≤‡∏î‡∏´‡∏•‡∏∏‡∏°‡πÅ‡∏Å‡πâ‡∏ß 3','‡∏Å‡∏ö‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ 2','‡∏Å‡∏ö‡∏¥‡∏ô‡∏ó‡∏£‡πå‡∏ö‡∏∏‡∏£‡∏µ 3',
    '‡∏ô‡∏≤‡∏î‡∏µ','‡∏ó‡πà‡∏≤‡∏à‡∏µ‡∏ô','‡∏£‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏´‡∏á','‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£','‡∏≠‡πâ‡∏≠‡∏°‡∏ô‡πâ‡∏≠‡∏¢','‡∏™‡∏±‡∏ï‡∏´‡∏µ‡∏ö','‡∏≠‡∏≠‡πÄ‡∏á‡∏¥‡∏ô'
  ];
  const MARKETS = ['‡∏ï‡∏•‡∏≤‡∏î‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏¥‡πâ‡∏°(‡∏≠‡∏∏‡∏î‡∏°‡∏™‡∏∏‡∏Ç)','‡∏ï‡∏•‡∏≤‡∏î‡∏ä‡∏≤‡∏î‡∏≤','‡∏ï‡∏•‡∏≤‡∏î‡∏ö‡∏∂‡∏á‡∏Å‡∏∏‡πà‡∏°'];
  const OPERATOR_OPTIONS = ['‡∏ä‡πà‡∏≤‡∏á‡∏™‡∏≥‡∏£‡∏≤‡∏ç','‡∏ä‡πà‡∏≤‡∏á‡πÇ‡∏Å‡πã','‡∏ä‡πà‡∏≤‡∏á‡πÇ‡∏´‡∏ô‡πà‡∏á','‡∏ä‡πà‡∏≤‡∏á‡∏ö‡∏≤‡∏™','‡∏ä‡πà‡∏≤‡∏á‡∏ö‡∏≠‡∏•'];

  let images = [];

  function setToday(){ const inp = $('date'); if (inp) inp.value = new Date().toISOString().split('T')[0]; }
  function formatDateTH(iso){ if(!iso) return '-'; const d=new Date(iso+'T00:00:00'); return d.toLocaleDateString('th-TH',{year:'numeric',month:'long',day:'numeric'}); }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  /* ---------- ‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå: (dd-mm-yyyy)-(‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó) ---------- */
  function sanitizeFileName(name){ return name.replace(/[\\\/:*?"<>|\n\r]+/g, '_').trim(); }
  function buildUserFileName(){
    let iso = $('date')?.value || '';
    const d = iso ? new Date(iso + 'T00:00:00') : new Date();
    const dd = pad2(d.getDate()), mm = pad2(d.getMonth()+1), yyyy = d.getFullYear();
    const datePart = `${dd}-${mm}-${yyyy}`;

    const cat = $('category')?.value || '';
    let typeStr = '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
    if (cat === '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£'){
      typeStr = `‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£-${$('projectSite')?.value || '-'}`;
    } else if (cat === '‡∏ï‡∏•‡∏≤‡∏î'){
      typeStr = `‡∏ï‡∏•‡∏≤‡∏î-${$('marketName')?.value || '-'}`;
    }
    return sanitizeFileName(`${datePart}-${typeStr}.pdf`);
  }

  /* ---------- ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó -> ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£/‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î ---------- */
  function renderProjectField() {
    const wrap = $('projectGroup'); if (!wrap) return; wrap.innerHTML = '';
    const category = $('category')?.value; if (!category) return;

    const group = document.createElement('div'); group.className = 'form-group';
    let labelText = '', selectId = '', options = [];
    if (category === '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£') { labelText = 'üèóÔ∏è ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£'; selectId = 'projectSite'; options = BUILDING_PROJECTS; }
    if (category === '‡∏ï‡∏•‡∏≤‡∏î') { labelText = 'üõí ‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î'; selectId = 'marketName'; options = MARKETS; }

    const label = document.createElement('label'); label.setAttribute('for', selectId); label.textContent = labelText;
    const select = document.createElement('select'); select.id = selectId; select.required = true;

    const opt0 = document.createElement('option'); opt0.value = ''; opt0.textContent = (category === '‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£') ? '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£' : '‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î';
    select.appendChild(opt0);
    options.forEach(name => { const opt=document.createElement('option'); opt.value=name; opt.textContent=name; select.appendChild(opt); });

    group.appendChild(label); group.appendChild(select);
    wrap.appendChild(group);
  }

  /* ---------- ‡∏ú‡∏π‡πâ‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£ ---------- */
  function renderOperatorsChecklist(){
    const list = $('operatorsChecklist'); if (!list) return;
    list.className = 'checklist'; list.innerHTML = '';

    OPERATOR_OPTIONS.forEach(name=>{
      const label = document.createElement('label');
      label.className = 'check-item';
      label.innerHTML = `<input type="checkbox" class="op-check" value="${name}"><span class="check-label">${name}</span>`;
      list.appendChild(label);
    });

    const labelOther = document.createElement('label');
    labelOther.className = 'check-item';
    labelOther.innerHTML = `<input type="checkbox" id="opOtherChk" value="other"><span class="check-label">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</span>`;
    list.appendChild(labelOther);

    list.addEventListener('change', (e)=>{ if (e.target && e.target.id === 'opOtherChk') updateOperatorOtherVisibility(); });
  }

  function addOtherField(value=''){
    const wrap = $('operatorOtherWrap'); if (!wrap) return;
    const count = wrap.querySelectorAll('.other-item').length;
    if (count >= MAX_OTHER_FIELDS){ alert(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÑ‡∏î‡πâ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${MAX_OTHER_FIELDS} ‡∏ä‡πà‡∏≠‡∏á`); return; }

    const row = document.createElement('div');
    row.className = 'other-item';
    row.innerHTML = `
      <input type="text" class="operator-other-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°" value="${value.replace(/"/g,'&quot;')}">
      <button type="button" class="other-remove" title="‡∏•‡∏ö‡∏ä‡πà‡∏≠‡∏á">‚Äì</button>
    `;
    row.querySelector('.other-remove').addEventListener('click', ()=>{ row.remove(); });
    wrap.appendChild(row);
  }
  function clearOtherFields(){ const wrap = $('operatorOtherWrap'); if (wrap) wrap.innerHTML = ''; }

  function updateOperatorOtherVisibility(){
    const show = !!$('opOtherChk')?.checked;
    const grp = $('operatorOtherGroup'); if (!grp) return;
    grp.classList.toggle('hidden', !show);
    if (show){
      const count = $('operatorOtherWrap')?.querySelectorAll('.other-item').length || 0;
      if (count === 0) addOtherField('');
    }else{
      clearOtherFields();
    }
  }

  function getOperatorsList(){
    const checked = Array.from(document.querySelectorAll('.op-check:checked')).map(cb=>cb.value);
    let names = [...checked];
    if ($('opOtherChk')?.checked){
      const others = Array.from(document.querySelectorAll('.operator-other-input')).map(inp => inp.value.trim()).filter(Boolean);
      const expanded = [];
      others.forEach(v => v.split(',').map(s=>s.trim()).filter(Boolean).forEach(x => expanded.push(x)));
      names = names.concat(expanded);
    }
    const seen = new Set(); const out=[]; for (const n of names){ if(!seen.has(n)){ seen.add(n); out.push(n); } }
    return out;
  }

  /* ---------- ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (‡∏Å‡∏£‡∏¥‡∏î + pan/zoom + DnD) ---------- */
  function renderImageGrid(){
    const grid = $('imageGrid'); if (!grid) return; grid.innerHTML = '';
    for (let i=0;i<MAX_IMAGES;i++){
      const slot = document.createElement('div'); slot.className = 'image-slot';
      if (images[i]){
        slot.innerHTML = `
          <button type="button" class="remove-image" data-index="${i}" title="‡∏•‡∏ö‡∏£‡∏π‡∏õ">√ó</button>
          <img src="${images[i].src}" alt="‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ${i+1}" data-index="${i}">
          <div class="edit-hint">‡∏•‡∏≤‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô ‚Ä¢ ‡∏•‡πâ‡∏≠‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ã‡∏π‡∏° ‚Ä¢ ‡∏î‡∏±‡∏ö‡πÄ‡∏ö‡∏¥‡∏•‡∏Ñ‡∏•‡∏¥‡∏Å‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï</div>`;
      } else {
        slot.innerHTML = `<div class="image-placeholder"><div style="font-size:30px;margin-bottom:6px">üñºÔ∏è</div><div>‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û ${i+1}</div></div>`;
      }
      grid.appendChild(slot);
    }
    grid.querySelectorAll('.remove-image').forEach(btn=>{
      btn.addEventListener('click', e=>{ const idx=+e.currentTarget.dataset.index; images.splice(idx,1); renderImageGrid(); });
    });

    requestAnimationFrame(()=> {
      grid.querySelectorAll('img[data-index]').forEach(imgEl=>{
        const idx = +imgEl.dataset.index; applyTransformToGridImage(idx, imgEl);
        let dragging=false,startX=0,startY=0,startDxPct=0,startDyPct=0,slotW=0,slotH=0;
        imgEl.addEventListener('mousedown', ev=>{
          ev.preventDefault(); dragging=true; imgEl.classList.add('dragging');
          startX=ev.clientX; startY=ev.clientY; startDxPct=images[idx].dxPct||0; startDyPct=images[idx].dyPct||0;
          const rect=imgEl.parentElement.getBoundingClientRect(); slotW=rect.width; slotH=rect.height;
        });
        window.addEventListener('mousemove', ev=>{
          if(!dragging) return; const st=images[idx];
          if (st.scale<=1){ st.dxPct=0; st.dyPct=0; applyTransformToGridImage(idx,imgEl); return; }
          const dx=(ev.clientX-startX)/slotW, dy=(ev.clientY-startY)/slotH, max=(st.scale-1)/2;
          st.dxPct=clamp(startDxPct+dx,-max,max); st.dyPct=clamp(startDyPct+dy,-max,max); applyTransformToGridImage(idx,imgEl);
        });
        window.addEventListener('mouseup', ()=>{ if(dragging){ dragging=false; imgEl.classList.remove('dragging'); } });
        imgEl.addEventListener('wheel', ev=>{
          ev.preventDefault(); const st=images[idx]; const next=clamp((st.scale||1)*(1 - ev.deltaY*0.001),1,3); st.scale=next;
          const max=(st.scale-1)/2; st.dxPct=clamp(st.dxPct||0,-max,max); st.dyPct=clamp(st.dyPct||0,-max,max); applyTransformToGridImage(idx,imgEl);
        });
        imgEl.addEventListener('dblclick', ()=>{ images[idx].scale=1; images[idx].dxPct=0; images[idx].dyPct=0; applyTransformToGridImage(idx,imgEl); });
      });
    });
  }
  function applyTransformToGridImage(idx, imgEl){
    const st = images[idx] || { dxPct:0, dyPct:0, scale:1 };
    const rect = imgEl.parentElement.getBoundingClientRect();
    imgEl.style.setProperty('--tx', (st.dxPct||0)*rect.width + 'px');
    imgEl.style.setProperty('--ty', (st.dyPct||0)*rect.height + 'px');
    imgEl.style.setProperty('--scale', (st.scale||1));
  }
  function updateAllGridTransforms(){ document.querySelectorAll('#imageGrid img[data-index]').forEach(imgEl=>{ const idx=+imgEl.dataset.index; applyTransformToGridImage(idx,imgEl); }); }

  function bindDragAndDrop(){
    const zone = $('imageSection'); if (!zone) return;
    let dragCounter = 0;
    const addHL = ()=> zone.classList.add('dragover');
    const rmHL  = ()=> zone.classList.remove('dragover');

    ['dragenter','dragover'].forEach(evt=>{
      zone.addEventListener(evt, (e)=>{ e.preventDefault(); dragCounter++; addHL(); });
    });
    zone.addEventListener('dragleave', (e)=>{ e.preventDefault(); dragCounter--; if (dragCounter<=0) { dragCounter=0; rmHL(); } });
    zone.addEventListener('drop', (e)=>{
      e.preventDefault(); dragCounter=0; rmHL();
      const dt = e.dataTransfer;
      if (dt?.files && dt.files.length){ handleFileList(dt.files); }
    });
  }

  /* ---------- PDF helper (‡∏Ñ‡∏£‡∏≠‡∏õ 4:3) ---------- */
  function loadImage(src){ return new Promise((res,rej)=>{ const img=new Image(); img.onload=()=>res(img); img.onerror=rej; img.src=src; }); }
  function generateCroppedDataURL(st, targetW=1200, targetH=900){
    return loadImage(st.src).then(img=>{
      const W=img.naturalWidth||img.width, H=img.naturalHeight||img.height;
      const c=document.createElement('canvas'); c.width=targetW; c.height=targetH; const ctx=c.getContext('2d');
      const s0=Math.max(targetW/W, targetH/H); const s=s0*(st.scale||1);
      const drawW=W*s, drawH=H*s;
      const dx_px=(st.dxPct||0)*targetW, dy_px=(st.dyPct||0)*targetH;
      const dx=(targetW-drawW)/2 + dx_px, dy=(targetH-drawH)/2 + dy_px;
      ctx.fillStyle='#fff'; ctx.fillRect(0,0,targetW,targetH); ctx.imageSmoothingQuality='high';
      ctx.drawImage(img, dx, dy, drawW, drawH);
      return c.toDataURL('image/jpeg', 0.92);
    });
  }
  function forcePrintSlotsTo4x3(){
    const slots = Array.from(document.querySelectorAll('#p-images .p-img-slot'));
    slots.forEach(slot=>{ const w=slot.clientWidth; slot.style.height = (w*3/4) + 'px'; });
  }

  /* ---------- ‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏ó‡∏°‡πÄ‡∏û‡∏•‡∏ï PDF ---------- */
  async function fillPrintTemplate(){
    $('p-date').textContent = `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${formatDateTH($('date')?.value)}`;

    const cat = $('category')?.value; let headerLabel='‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£', headerValue='-';
    if (cat==='‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£'){ headerLabel='‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£'; headerValue=$('projectSite')?.value || '-'; }
    if (cat==='‡∏ï‡∏•‡∏≤‡∏î'){ headerLabel='‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏•‡∏≤‡∏î'; headerValue=$('marketName')?.value || '-'; }
    $('p-project').textContent = `${headerLabel}: ${headerValue}`;

    const opNames = getOperatorsList(); const opText = opNames.length ? opNames.join(', ') : '-';
    $('p-operator').textContent = opText; $('p-footer-operator').textContent = opText;

    $('p-details-text').textContent = $('details')?.value || '-';

    const useImages = images.slice(0, MAX_IMAGES);
    const body = $('p-body');
    const wrap = $('p-images'); wrap.innerHTML = '';

    const hasImgs = useImages.length > 0;
    $('p-images-title').style.display = hasImgs ? 'block' : 'none';

    wrap.classList.toggle('two-cols-six', useImages.length === 6);
    body.classList.toggle('tight', useImages.length === 6);

    if (hasImgs){
      useImages.forEach(()=> {
        const slot = document.createElement('div'); slot.className = 'p-img-slot';
        const img = document.createElement('img'); img.alt = '';
        slot.appendChild(img); wrap.appendChild(slot);
      });

      forcePrintSlotsTo4x3();

      const crops = await Promise.all(useImages.map(st => generateCroppedDataURL(st, 1200, 900)));
      Array.from(wrap.querySelectorAll('.p-img-slot img')).forEach((imgEl, i)=>{ imgEl.src = crops[i]; });
    }
  }

  async function waitImagesLoaded(root){
    const imgs = Array.from(root.querySelectorAll('img')); if (!imgs.length) return;
    await Promise.all(imgs.map(img => (img.decode ? img.decode() : Promise.resolve()).catch(()=>{})));
    await new Promise(r => requestAnimationFrame(r));
  }

  /* ---------- ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF ---------- */
  async function exportPDF(){
    if (!validate()){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô'); return; }
    const btn=$('btnExport'); const old=btn.innerHTML; btn.disabled=true; btn.innerHTML='‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á PDF...';
    try{
      await fillPrintTemplate();
      const printArea=$('printArea'); await waitImagesLoaded(printArea);
      const canvas=await html2canvas(printArea,{ scale:2,useCORS:true,allowTaint:true,imageTimeout:0,backgroundColor:'#ffffff',width:794,height:1123,windowWidth:1000 });
      const imgData=canvas.toDataURL('image/jpeg',0.98);
      const { jsPDF }=window.jspdf; const pdf=new jsPDF({orientation:'p',unit:'mm',format:'a4',compress:true});
      pdf.addImage(imgData,'JPEG',0,0,210,297,undefined,'FAST');

      const suggested = buildUserFileName();
      const input = prompt('‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå PDF', suggested);
      if (input === null) return;

      let name = input.trim() === '' ? suggested : sanitizeFileName(input.trim());
      if (!/\.pdf$/i.test(name)) name += '.pdf';
      pdf.save(name);
    }catch(e){
      console.error(e);
      alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á PDF');
    }finally{
      btn.disabled=false; btn.innerHTML=old;
    }
  }

  function validate(){
    const baseOk=['date','category','details'].every(id=>{ const el=$(id); return el && String(el.value||'').trim()!==''; });
    if (!baseOk) return false;
    const cat=$('category')?.value;
    if (cat==='‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£' && (!$('projectSite') || !$('projectSite').value.trim())) return false;
    if (cat==='‡∏ï‡∏•‡∏≤‡∏î' && (!$('marketName') || !$('marketName').value.trim())) return false;
    if (getOperatorsList().length===0) return false;
    return true;
  }

  /* ---------- Upload: ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å + Drag&Drop ---------- */
  function openPicker(){
    const remain=Math.max(0, MAX_IMAGES - images.length);
    if (remain<=0){ alert('‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß (6 ‡∏£‡∏π‡∏õ)'); return; }
    const input=$('imageInput'); if (!input) return;
    if (remain>1) input.setAttribute('multiple','multiple'); else input.removeAttribute('multiple');
    input.click();
  }
  function handleFiles(e){
    const files=Array.from(e.target.files||[]); if (!files.length) return;
    handleFileList(files);
    e.target.value='';
  }
  function handleFileList(fileList){
    const files=Array.from(fileList||[]); if (!files.length) return;
    const remain=Math.max(0, MAX_IMAGES - images.length);
    if (remain<=0){ alert('‡∏Ñ‡∏£‡∏ö‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏£‡∏π‡∏õ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡πÅ‡∏•‡πâ‡∏ß (6 ‡∏£‡∏π‡∏õ)'); return; }
    const batch=files.slice(0,remain);
    let done=0;
    batch.forEach(file=>{
      if (!file.type || !file.type.startsWith('image/')){ if (++done===batch.length) renderImageGrid(); return; }
      const reader=new FileReader();
      reader.onload=(ev)=>{
        const dataUrl=ev.target.result; const img=new Image();
        img.onload=()=>{ images.push({ src:dataUrl, dxPct:0, dyPct:0, scale:1 }); if (++done===batch.length) renderImageGrid(); };
        img.onerror=()=>{ if (++done===batch.length) renderImageGrid(); };
        img.src=dataUrl;
      };
      reader.readAsDataURL(file);
    });
  }

  function clearAll(){
    if (!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
    $('engineeringForm')?.reset(); images=[];
    document.querySelectorAll('#operatorsChecklist input[type="checkbox"]').forEach(cb=> cb.checked=false);
    updateOperatorOtherVisibility();
    renderImageGrid(); setToday();
    const input=$('imageInput'); if (input) input.value='';
    $('projectGroup').innerHTML=''; window.scrollTo({ top: 0, behavior: 'smooth' });
    alert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß');
  }

  /* ---------- Bind & Init ---------- */
  function bindEvents(){
    $('addImageBtn')?.addEventListener('click', openPicker);
    $('imageInput')?.addEventListener('change', handleFiles);
    $('btnExport')?.addEventListener('click', exportPDF);
    $('clearAllBtn')?.addEventListener('click', clearAll);
    $('category')?.addEventListener('change', renderProjectField);

    $('addOtherBtn')?.addEventListener('click', ()=> addOtherField(''));

    const back=$('backToTop');
    back?.addEventListener('click', ()=> window.scrollTo({top:0,behavior:'smooth'}));
    window.addEventListener('scroll', ()=>{ if (!back) return; if (window.scrollY>300) back.classList.add('show'); else back.classList.remove('show'); });
    window.addEventListener('resize', updateAllGridTransforms);

    bindDragAndDrop();
  }

  // init
  bindEvents();
  setToday(); renderProjectField(); renderOperatorsChecklist(); updateOperatorOtherVisibility(); renderImageGrid();
})();
</script>
</body>
</html>